pipeline {
   agent any

   environment {
            AWS_ACCESS_KEY_ID     = credentials ('AWS_ACCESS_KEY_ID')
            AWS_SECRET_ACCESS_KEY = credentials ('AWS_SECRET_ACCESS_KEY')
        }

   stages {
      stage('scm checkout') {
         steps {
            // Get code from a GitHub repository
            git 'https://github.com/chine-imo/WAIP.git'
         }
      }

   stage('initialize tf') {
         steps {
            // initialize configuration files in working diectory
            sh 'terraform init'
         }
      }

      stage('validate tf') {
         steps {
            // validates the configuration files in a directory 
            sh 'terraform validate'
         }
      }

      stage('plan tf') {
         steps {
            // create terraform execution plan
            sh 'terraform plan'
         }
      }

      stage('apply tf') {
         steps {
            // validates the configuration files in a directory 
            sh 'terraform apply -auto-approve'
         }
      }

      
   }
}
